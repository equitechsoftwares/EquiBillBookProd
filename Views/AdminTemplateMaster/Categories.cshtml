@model IEnumerable<EquiBillBook.Models.ClsInvoiceTemplateColorCategoryMaster>
@using System.Web

@{
    ViewBag.Title = "Template Color Categories";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    var invoiceTemplateMasterId = (long)ViewBag.InvoiceTemplateMasterId;
    var templateName = ViewBag.TemplateName as string ?? $"Pre-defined Template #{invoiceTemplateMasterId}";
}

<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1>Color Categories - @templateName</h1>
                <div class="float-left">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="/admindashboard/index">Dashboard</a></li>
                        <li class="breadcrumb-item"><a href="/admintemplatemaster/index">Template Masters</a></li>
                        <li class="breadcrumb-item active">Categories</li>
                    </ol>
                </div>
            </div>
            <div class="col-sm-6">
                <a href="@Url.Action("CreateCategory", "AdminTemplateMaster", new { invoiceTemplateMasterId = invoiceTemplateMasterId })"
                   class="btn btn-primary float-sm-right">
                    <i class="fas fa-plus"></i> New Category
                </a>
            </div>
        </div>
    </div>
</section>

<section class="content">
    <div class="container-fluid">
        @Html.AntiForgeryToken()
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success">@TempData["SuccessMessage"]</div>
        }
        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger">@TempData["ErrorMessage"]</div>
        }

        @if (Model != null && Model.Any())
        {
            <div class="card card-primary card-outline">
                <div class="card-body table-responsive p-0">
                    <table class="table table-bordered table-striped table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Id</th>
                                <th class="hide noPrint" style="width:100px;">Actions</th>
                                <th>Key</th>
                                <th>Name</th>
                                <th>Icon</th>
                                <th>Description</th>
                                <th>Sort</th>
                                <th class="hidden">Status</th>
                                <th class="hide">Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var c in Model.OrderBy(c => c.SortOrder).ThenBy(c => c.CategoryName))
                            {
                                <tr>
                                    <td>@c.InvoiceTemplateColorCategoryMasterId</td>
                                    <td class="hide noPrint">
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-info">Action</button>
                                            <button type="button" class="btn btn-info dropdown-toggle dropdown-icon" data-toggle="dropdown">
                                                <span class="sr-only">Toggle Dropdown</span>
                                            </button>
                                            <div class="dropdown-menu" role="menu">
                                                <a class="dropdown-item" href="@Url.Action("EditCategory", "AdminTemplateMaster", new { id = c.InvoiceTemplateColorCategoryMasterId })"><i class="fas fa-edit"></i> Edit</a>
                                                <a class="dropdown-item" href="javascript:void(0)" onclick="DeleteCategory(@c.InvoiceTemplateColorCategoryMasterId,'@Html.Raw(HttpUtility.JavaScriptStringEncode(c.CategoryName))')"><i class="far fa-trash-alt"></i> Delete</a>
                                            </div>
                                        </div>
                                    </td>
                                    <td>@c.CategoryKey</td>
                                    <td>@c.CategoryName</td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(c.Icon))
                                        {
                                            <i class="@c.Icon"></i> @c.Icon
                                        }
                                        else
                                        {
                                            <span class="text-muted">-</span>
                                        }
                                    </td>
                                    <td>@(string.IsNullOrEmpty(c.Description) ? "-" : c.Description)</td>
                                    <td>@c.SortOrder</td>
                                    <td class="hidden">@(c.IsActive == true ? "Active" : "Inactive")</td>
                                    <td class="hide">
                                        @if (c.IsActive)
                                        {
                                            <input class="chkIsActive" type="checkbox" onchange="ActiveInactiveCategory(@c.InvoiceTemplateColorCategoryMasterId,false)" checked data-on="Active" data-off="In Active" data-toggle="toggle" data-onstyle="success" data-offstyle="danger" data-width="100" data-height="25" data-style="design">
                                        }
                                        else
                                        {
                                            <input class="chkIsActive" type="checkbox" onchange="ActiveInactiveCategory(@c.InvoiceTemplateColorCategoryMasterId,true)" data-on="Active" data-off="In Active" data-toggle="toggle" data-onstyle="success" data-offstyle="danger" data-width="100" data-height="25" data-style="design">
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        }
        else
        {
            <div class="card card-primary card-outline">
                <div class="card-body">
                    <p class="text-center text-muted">No color categories found for this template.</p>
                </div>
            </div>
        }
    </div>
</section>

<script src="~/Content/JQuery/Admin/AdminTemplateMaster.js"></script>
<script>
    function DeleteCategory(id, name) {
        if (confirm('Are you sure you want to delete the category "' + name + '"?')) {
            var form = document.createElement('form');
            form.method = 'POST';
            form.action = '@Url.Action("DeleteCategory", "AdminTemplateMaster")';
            
            var token = document.querySelector('input[name="__RequestVerificationToken"]').value;
            var tokenInput = document.createElement('input');
            tokenInput.type = 'hidden';
            tokenInput.name = '__RequestVerificationToken';
            tokenInput.value = token;
            form.appendChild(tokenInput);
            
            var idInput = document.createElement('input');
            idInput.type = 'hidden';
            idInput.name = 'id';
            idInput.value = id;
            form.appendChild(idInput);
            
            document.body.appendChild(form);
            form.submit();
        }
    }

</script>

