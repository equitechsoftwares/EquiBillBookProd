
@{
    ViewBag.Title = Request.Cookies["data"].Value.Split('&')[8].Split('=')[1] + (ViewBag.BillOfEntry.BillOfEntryNo == null ? " | Add Bill Of Entry" : " | Edit Bill Of Entry");
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";
}

<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">

                @if (ViewBag.BillOfEntry.BillOfEntryNo == null)
                {
                    <h1>Add Bill Of Entry</h1>
                }
                else
                {
                    <h1>Edit Bill Of Entry</h1>
                }

                <div class="float-left">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="/dashboard/index">Dashboard</a></li>
                        <li class="breadcrumb-item"><a href="/Purchase/index">Purchase Invoices</a></li>

                        @if (ViewBag.BillOfEntry.BillOfEntryNo == null)
                        {
                            <li class="breadcrumb-item active">Add Bill Of Entry</li>
                        }
                        else
                        {
                            <li class="breadcrumb-item active">Edit Bill Of Entry</li>
                        }
                    </ol>
                </div>
            </div>
            <div class="col-md-6 col-12 d-flex align-items-center justify-content-start justify-content-md-end mt-1 mt-md-0">
                <a id="btnBack" href="/Purchase/PurchaseReturn" class="btn btn-warning float-sm-right"><i class="fas fa-arrow-left"></i> Back</a>
                @*<a href="javascript:void(0)" data-toggle="modal" data-target="#faqModal" class="btn btn-secondary float-sm-right mr-2">FAQs</a>*@
            </div>
        </div>
    </div><!-- /.container-fluid -->
</section>
<!-- Main content -->
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <!-- left column -->
            <div class="col-md-12">
                <div class="callout callout-info @(Request.Cookies["SystemSetting"].Value.Split('&')[0].Split('=')[1] == "True" ? "":"hidden")">
                    @*<h5><i class="fas fa-info"></i> Note:</h5>*@
                    Only the fields which are marked with <span class="text-danger">*</span> is mandatory. Rest all fields are optional and can be skipped
                    @*<button class="btn btn-info btn-sm" onclick="insert()"> Check Mandatory Fields</button>*@
                </div>
                <!-- jquery validation -->
                <div class="card card-primary card-outline">
                    @*<div class="card-header">
                            <button type="submit" class="btn btn-primary">Submit</button>
                        </div>*@
                    <div class="card-body">
                        @*<div class="card card-outline">

                                <div class="card-header">
                                        <h3 class="card-title">Parent Sale Info</h3>
                                    </div>
                                <div class="card-body">

                                    <div class="row invoice-info">
                                        <div class="col-sm-6 invoice-col">
                                            <strong>Invoice </strong>@ViewBag.BillOfEntry.PurchaseInvoiceNo<br>
                                            <strong>Date </strong>: @ViewBag.BillOfEntry.PurchaseDate<br>
                                        </div>
                                        <div class="col-sm-6 invoice-col">
                                            <strong>Supplier </strong>@ViewBag.BillOfEntry.SupplierName<br>
                                            <strong>Business Location </strong>@ViewBag.BillOfEntry.Branch<br>
                                        </div>
                                    </div>
                                </div>

                            </div>*@
                        <div class="card card-outline">

                            @*<div class="card-header">
                                    <h3 class="card-title">Purchase Return Info</h3>
                                </div>*@
                            <!-- form start -->
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-2">
                                        <div class="form-group">
                                            <label>Invoice No</label>
                                            <input disabled type="text" class="form-control" id="txtPurchaseInvoiceNo" value="@ViewBag.BillOfEntry.PurchaseInvoiceNo">
                                            @*<small class="text-red font-weight-bold errorText" id="divInvoiceNo"></small>*@
                                        </div>
                                    </div>
                                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-2">
                                        <div class="form-group">
                                            <label>Bill Of Entry No <span class="danger">*</span></label>
                                            <input type="text" class="form-control" id="txtBillOfEntryNo" value="@ViewBag.BillOfEntry.BillOfEntryNo">
                                            <small class="text-red font-weight-bold errorText" id="divBillOfEntryNo"></small>
                                        </div>
                                    </div>
                                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-2">
                                        <div class="form-group">
                                            <label>Port Code <span class="danger">*</span></label>
                                            <input type="text" class="form-control" id="txtPortCode" value="@ViewBag.BillOfEntry.PortCode">
                                            <small class="text-red font-weight-bold errorText" id="divPortCode"></small>
                                        </div>
                                    </div>
                                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-2">
                                        <div class="form-group">
                                            <label>Date <span class="danger">*</span></label>
                                            <div class="input-group date" id="_BillOfEntryDate" data-target-input="nearest">
                                                <input id="txtBillOfEntryDate" value="@(ViewBag.BillOfEntry.BillOfEntryDate!= DateTime.MinValue?ViewBag.BillOfEntry.BillOfEntryDate.ToString(Request.Cookies["BusinessSetting"].Value.Split('&')[0].Split('=')[1] + " " + Request.Cookies["BusinessSetting"].Value.Split('&')[1].Split('=')[1]):"")" type="text" class="form-control datetimepicker-input" data-target="#_BillOfEntryDate" />
                                                <div class="input-group-append" data-target="#_BillOfEntryDate" data-toggle="datetimepicker">
                                                    <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                                                </div>
                                            </div>
                                            <small class="text-red font-weight-bold errorText" id="divBillOfEntryDate"></small>
                                        </div>
                                    </div>
                                    @if (ViewBag.IsAccountsAddon == true)
                                    {
                                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-2">
                                            <!-- text input -->
                                            <div class="form-group">
                                                <label>Paid Through <span class="danger">*</span></label>
                                                <div class="input-group">
                                                    <select class="form-control select2" id="ddlPaidThrough">
                                                        @*<option value="0">Select</option>*@
                                                        @{
                                                            if (ViewBag.AccountSubTypes != null)
                                                            {
                                                                foreach (var item in ViewBag.AccountSubTypes)
                                                                {
                                                                    if (item.Accounts.Count > 0)
                                                                    {
                                                                        <optgroup label="@item.DisplayAs">
                                                                            @foreach (var inner in item.Accounts)
                                                                            {
                                                                                if (inner.Type == "Petty Cash")
                                                                                {
                                                                                    <option value="@inner.AccountId" selected>@inner.DisplayAs</option>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <option value="@inner.AccountId">@inner.DisplayAs</option>
                                                                                }
                                                                            }
                                                                        </optgroup>
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    </select>
                                                </div>
                                                <small class="text-red font-weight-bold errorText" id="divPaidThrough"></small>
                                            </div>
                                        </div>
                                    }
                                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-2">
                                        <div class="form-group">
                                            <label>Reference# <i tabindex="0" class="fa fa-info-circle text-info hover-q no-print @(Request.Cookies["SystemSetting"].Value.Split('&')[0].Split('=')[1] == "True" ? "":"hidden")" role="button" data-toggle="popover" data-trigger="focus" title="" data-content="Leave blank to auto generate"></i></label>
                                            <input type="text" class="form-control" id="txtReferenceNo">
                                            <small class="text-red font-weight-bold errorText" id="divReferenceNo"></small>
                                        </div>
                                    </div>
                                    
                                        <div class="col-12 col-sm-6 col-md-4 col-lg-3 col-xl-2">
                                            <div class="form-group">
                                                <label>Attach Document</label>
                                                <div class="custom-file">
                                                    <input type="file" id="AttachDocument" class="custom-file-input" accept='image/*' onchange="getAttachDocumentBase64()">
                                                    <label class="custom-file-label" for="Logo">Choose file</label>
                                                </div>
                                                <img id="blahAttachDocument" src="@ViewBag.BillOfEntry.AttachDocument" alt="" height="60" style="padding-top:10px;">
                                            </div>
                                        </div>
                                </div>
                            </div>
                        </div>
                        <div class="card card-outline">
                            <div class="card-header bg-info">
                                <h3 class="card-title">Item List</h3>
                            </div>
                            <!-- form start -->
                            <div class="card-body">
                                <div class="row table-responsive">
                                    <table class="table table-bordered table-striped">
                                        <thead>
                                            <tr>
                                                <th>Item Details</th>
                                                <th>
                                                    Assessable Value
                                                    ( Quantity x Rate x Exchange-rate ) + Additional Charges if any
                                                </th>
                                                <th>Custom Duty + Additional Charges</th>
                                                <th>Amount Exc Tax</th>
                                                <th>Tax</th>
                                                <th style="display:none">Amount Inc Tax</th>
                                            </tr>
                                        </thead>
                                        <tbody id="divCombo">
                                            @{
                                                var count = 100000000;
                                                foreach (var item in ViewBag.BillOfEntry.BillOfEntryDetails)
                                                {
                                                    <tr id="divCombo@(count)">
                                                        <td>
                                                            <input type="text" hidden class="form-control" id="txtItemId@(count)" value="@item.ItemId">
                                                            <input type="text" hidden class="form-control" id="txtItemDetailsId@(count)" value="@item.ItemDetailsId">
                                                            <input type="text" hidden class="form-control" id="txtSkuCode@(count)" value="@item.SKU">
                                                            <input type="text" hidden class="form-control" id="txtBillOfEntryDetailsId@(count)" value="@item.BillOfEntryDetailsId">
                                                            <input type="text" hidden class="form-control" id="txtPurchaseDetailsId@(count)" value="@item.PurchaseDetailsId">
                                                            <span> @item.ItemName</span>
                                                            @if (item.VariationName != null)
                                                            {
                                                                <br /><span> @item.VariationName</span>
                                                            }
                                                            <br /><span>SKU: @item.SKU</span>
                                                        </td>
                                                        <td>
                                                            <input type="number" class="form-control" value="@(String.Format("{0:0.##}",item.AssessableValue))" id="txtAssessableValue@(count)" onchange="calculate()" />
                                                        </td>
                                                        <td>
                                                            <input type="number" class="form-control" value="@(String.Format("{0:0.##}",item.CustomDuty))" id="txtCustomDuty@(count)" onchange="calculate()" />
                                                        </td>
                                                        <td>
                                                            <input disabled type="number" class="form-control" value="@(String.Format("{0:0.##}",item.AmountExcTax))" id="txtAmountExcTax@(count)" />
                                                        </td>
                                                        <td>
                                                            <div class="input-group" style="min-width:250px">
                                                                <select class="form-control select2 ddlTax" style="min-width: 160px;" id="ddlTax@(count)" onchange="calculate()">
                                                                    <option value="0">None</option>
                                                                    @foreach (var tax in ViewBag.Taxs)
                                                                    {
                                                                        if (tax.TaxTypeId == 3)
                                                                        {
                                                                            if (item.TaxId == tax.TaxId)
                                                                            {
                                                                                <option selected value="@tax.TaxId-@tax.TaxPercent">@tax.Tax</option>
                                                                            }
                                                                            else
                                                                            {
                                                                                <option value="@tax.TaxId-@tax.TaxPercent">@tax.Tax</option>
                                                                            }
                                                                        }
                                                                    }
                                                                </select>
                                                                <input type="hidden" value="@item.TaxAmount" id="hdnTaxAmount@(count)" />
                                                            </div>
                                                            <small class="text-red font-weight-bold" id="lblTaxAmount@(count)">Tax Amount: @item.TaxAmount</small>
                                                            <small class="text-red font-weight-bold errorText" id="divTax@(count)"></small>
                                                        </td>
                                                        <td style="display:none">
                                                            <input type="number" class="form-control" id="txtAmountIncTax@(count)" value="@item.AmountIncTax">
                                                        </td>
                                                    </tr>
                                                    count++;
                                                }
                                            }
                                        </tbody>

                                    </table>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="row mt-2">
                                        </div>
                                    </div>

                                    <div class="col-md-6">
                                        <div class="row">
                                            <div class="col-12">
                                                <div class=" row">
                                                    <label for="inputEmail3" class="col-10 col-form-label text-right">Total Custom Duty + Additional Charges :</label>
                                                    <input type="number" class="form-control" id="hdnTotalCustomDuty" hidden value="@ViewBag.BillOfEntry.TotalCustomDuty">
                                                    <label for="inputEmail3" class="col-2 col-form-label text-left" id="divTotalCustomDuty">
                                                        @{
                                                            if (Request.Cookies["BusinessSetting"].Value.Split('&')[2].Split('=')[1] == "1")
                                                            {
                                                                @Request.Cookies["data"].Value.Split('&')[5].Split('=')[1]@(String.Format("{0:0.##}",ViewBag.BillOfEntry.TotalCustomDuty))
                                                            }
                                                            else
                                                            {
                                                                @(String.Format("{0:0.##}",ViewBag.BillOfEntry.TotalCustomDuty))@Request.Cookies["data"].Value.Split('&')[5].Split('=')[1]
                                                            }
                                                        }
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="row">
                                                    <label for="inputEmail3" class="col-10 col-form-label text-right">Total Tax Amount :</label>
                                                    <input type="number" class="form-control" id="hdnTotalTaxAmount" hidden value="@ViewBag.BillOfEntry.TotalTaxAmount">
                                                    <label for="inputEmail3" class="col-2 col-form-label text-left" id="divTotalTaxAmount">
                                                        @{
                                                            if (Request.Cookies["BusinessSetting"].Value.Split('&')[2].Split('=')[1] == "1")
                                                            {
                                                                @Request.Cookies["data"].Value.Split('&')[5].Split('=')[1]@(String.Format("{0:0.##}",ViewBag.BillOfEntry.TotalTaxAmount))
                                                            }
                                                            else
                                                            {
                                                                @(String.Format("{0:0.##}",ViewBag.BillOfEntry.TotalTaxAmount))@Request.Cookies["data"].Value.Split('&')[5].Split('=')[1]
                                                            }
                                                        }
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="row">
                                                    <label for="inputEmail3" class="col-10 col-form-label text-right">Total Amount Paid :</label>
                                                    <input type="number" class="form-control" id="hdnTotalAmountPaid" hidden value="@ViewBag.BillOfEntry.TotalAmountPaid">
                                                    <label for="inputEmail3" class="col-2 col-form-label text-left" id="divTotalAmountPaid">
                                                        @{
                                                            if (Request.Cookies["BusinessSetting"].Value.Split('&')[2].Split('=')[1] == "1")
                                                            {
                                                                @Request.Cookies["data"].Value.Split('&')[5].Split('=')[1]@(String.Format("{0:0.##}",ViewBag.BillOfEntry.TotalAmountPaid))
                                                            }
                                                            else
                                                            {
                                                                @(String.Format("{0:0.##}",ViewBag.BillOfEntry.TotalAmountPaid))@Request.Cookies["data"].Value.Split('&')[5].Split('=')[1]
                                                            }
                                                        }
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <input type="hidden" id="hdnSubtotal" value="@ViewBag.BillOfEntry.Subtotal" />
                        <input type="hidden" id="hdnGrandTotal" value="@ViewBag.BillOfEntry.GrandTotal" />
                        <input type="hidden" value="@ViewBag.BillOfEntry.PurchaseId" id="hdnPurchaseId" />
                        <input type="hidden" value="@ViewBag.BillOfEntry.SupplierId" id="hdnSupplierId" />
                        <input type="hidden" value="@ViewBag.BillOfEntry.BranchId" id="hdnBranchId" />
                        <input type="hidden" value="@ViewBag.BillOfEntry.BillOfEntryId" id="hdnBillOfEntryId" />

                        @if (ViewBag.BillOfEntry.BillOfEntryNo == null)
                        {
                            <button type="submit" class="btn btn-primary float-right" onclick="insert()">Submit</button>
                        }
                        else
                        {
                            <button type="submit" class="btn btn-primary float-right" onclick="update()">Submit</button>
                        }
                    </div>
                </div>
                <!-- /.card -->
            </div>
            <!--/.col (left) -->

        </div>
        <!-- /.row -->
    </div><!-- /.container-fluid -->

</section>
<!-- /.content -->
<div class="modal fade" id="faqModal">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">FAQs</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="p-0 pl-2 pr-2">
                            <div class="card collapsed-card" data-card-widget="collapse" title="Collapse">
                                <div class="card-header" data-card-widget="collapse" title="Collapse">
                                    <h3 class="card-title">What is Purchase return invoice?</h3>
                                    <div class="card-tools">
                                        <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body" style="display: none;">
                                    A Purchase return is merchandise sent back by a buyer to the seller. The return is usually because an excess quantity was either ordered or shipped, or due to defective goods.
                                </div>
                            </div>
                            <div class="card collapsed-card" data-card-widget="collapse" title="Collapse">
                                <div class="card-header" data-card-widget="collapse" title="Collapse">
                                    <h3 class="card-title">Is a Purchase return an expense?</h3>
                                    <div class="card-tools">
                                        <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body" style="display: none;">
                                    Purchase returns are known as a contra revenue account and they have a direct effect on the net income, thereby reducing the income. They cannot be considered as an expense but they do contribute to the loss of income.
                                </div>
                            </div>
                            <div class="card collapsed-card" data-card-widget="collapse" title="Collapse">
                                <div class="card-header" data-card-widget="collapse" title="Collapse">
                                    <h3 class="card-title">Is Purchase return debit or credit?</h3>
                                    <div class="card-tools">
                                        <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body" style="display: none;">
                                    Purchase return accounts are debited while the buyers' or the Suppliers' accounts are credited in the seller's account. Purchase accounts are reduced. Purchase accounts are reduced. A debit note is issued to the seller or the supplier of the goods.
                                </div>
                            </div>
                            <div class="card collapsed-card" data-card-widget="collapse" title="Collapse">
                                <div class="card-header" data-card-widget="collapse" title="Collapse">
                                    <h3 class="card-title">What is the difference between purchase return and Purchase return?</h3>
                                    <div class="card-tools">
                                        <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body" style="display: none;">
                                    By definition, purchase return is when the seller returns the goods from the buyer to the supplier due to inappropriate goods specification. Meanwhile, the Purchase return is a condition when the buyer returns the goods to the seller.
                                </div>
                            </div>
                            <div class="card collapsed-card" data-card-widget="collapse" title="Collapse">
                                <div class="card-header" data-card-widget="collapse" title="Collapse">
                                    <h3 class="card-title">Why are Purchase returns credited?</h3>
                                    <div class="card-tools">
                                        <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="card-body" style="display: none;">
                                    Accounting Treatment for Purchase Returns: The credit to the accounts receivable account will reduce the outstanding amount of accounts receivable. Conversely, if the sale was made against cash, the journal entry will require the same account to be debited but the credit will be against cash or payable to Supplier account.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default" data-dismiss="modal" style="margin-left:auto">Close</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<script src="~/Content/JQuery/Customer/Purchase/BillOfEntry.js"></script>