@{
    var recurringBookings = ViewBag.RecurringBookings as System.Collections.Generic.List<EquiBillBook.Models.ClsRecurringBookingVm> ?? new System.Collections.Generic.List<EquiBillBook.Models.ClsRecurringBookingVm>();
    var totalCount = ViewBag.TotalCount ?? 0;
    var activeCount = ViewBag.ActiveCount ?? 0;
    var inactiveCount = ViewBag.InactiveCount ?? 0;
    var pageSize = ViewBag.PageSize ?? 10;
    var currentPageIndex = ViewBag.CurrentPageIndex ?? 1;
    var pageCount = ViewBag.PageCount ?? 0;
}
<thead id="thead">
    <tr>
        <th>Recurring Booking ID</th>
        <th>Recurrence Type</th>
        <th>Repeat Pattern</th>
        <th>Start Date</th>
        <th>End Date</th>
        <th>Status</th>
        <th>Created On</th>
    </tr>
</thead>
<tbody class="table-body">
    @if (recurringBookings != null && recurringBookings.Count > 0)
    {
        foreach (var item in recurringBookings)
        {
            var repeatPattern = "-";
            if (item.RecurrenceType != null)
            {
                if (item.RecurrenceType.ToString() == "Daily")
                {
                    repeatPattern = $"Every {item.RepeatEveryNumber} day(s)";
                }
                else if (item.RecurrenceType.ToString() == "Weekly")
                {
                    repeatPattern = $"Every {item.RepeatEveryNumber} week(s)";
                }
                else if (item.RecurrenceType.ToString() == "Monthly")
                {
                    repeatPattern = item.DayOfMonth != null 
                        ? $"Every {item.RepeatEveryNumber} month(s) on day {item.DayOfMonth}"
                        : $"Every {item.RepeatEveryNumber} month(s)";
                }
            }
            
            <tr>
                <td><a href="/recurringbooking/details?RecurringBookingId=@item.RecurringBookingId">@item.RecurringBookingId</a></td>
                <td>@(item.RecurrenceType ?? "-")</td>
                <td>@repeatPattern</td>
                <td>@(item.StartDate != null ? item.StartDate.ToString("dd/MM/yyyy") : "-")</td>
                <td>@(item.EndDate != null ? ((DateTime)item.EndDate).ToString("dd/MM/yyyy") : "No End Date")</td>
                <td>
                    @if (item.IsActive)
                    {
                        <span class="badge badge-success">Active</span>
                    }
                    else
                    {
                        <span class="badge badge-danger">Inactive</span>
                    }
                </td>
                <td>@(item.AddedOn != null ? item.AddedOn.ToString("dd/MM/yyyy HH:mm") : "-")</td>
            </tr>
        }
    }
</tbody>
<tbody class="hide noPrint">
    <tr></tr>
    <tr>
        <td colspan="7">
            <div class="dataTables_info" id="tblRecurringBookingReport_info_custom" role="status" aria-live="polite">Showing @((currentPageIndex - 1) * pageSize + 1) to @(Math.Min(currentPageIndex * pageSize, totalCount)) of @totalCount entries</div>
            @if (pageCount > 1)
            {
                int j = 0;
                <div class="dataTables_paginate paging_simple_numbers" id="tblRecurringBookingReport_paginate_custom" style="float:right">
                    <ul class="pagination">
                        @if (currentPageIndex > 1)
                        {
                            <li class="paginate_button page-item previous" id="tblRecurringBookingReport_previous">
                                <a onclick="fetchList(1)" href="javascript:void(0)" aria-controls="tblRecurringBookingReport" data-dt-idx="0" tabindex="0" class="page-link">First</a>
                            </li>
                            <li class="paginate_button page-item previous" id="tblRecurringBookingReport_previous">
                                <a onclick="fetchList(@(currentPageIndex - 1))" href="javascript:void(0)" aria-controls="tblRecurringBookingReport" data-dt-idx="0" tabindex="0" class="page-link">Previous</a>
                            </li>
                        }
                        @for (int i = currentPageIndex; i <= pageCount; i++)
                        {
                            <li class="@(i == currentPageIndex ? "paginate_button page-item active" : "paginate_button page-item")">
                                <a onclick="fetchList(@i)" href="javascript:void(0)" aria-controls="tblRecurringBookingReport" data-dt-idx="1" tabindex="0" class="page-link">@(i)</a>
                            </li>
                            if (j == 10)
                            {
                                i = pageCount + 1;
                            }
                            j++;
                        }
                        @if (currentPageIndex < pageCount)
                        {
                            <li class="paginate_button page-item next" id="tblRecurringBookingReport_next">
                                <a onclick="fetchList(@(currentPageIndex + 1))" href="javascript:void(0)" aria-controls="tblRecurringBookingReport" data-dt-idx="2" tabindex="0" class="page-link">Next</a>
                            </li>
                        }
                    </ul>
                </div>
            }
        </td>
    </tr>
</tbody>
<script type="text/javascript">
    $('#divTotalCount').text('Total : ' + @Html.Raw(Json.Encode(totalCount)));
    $('#divActiveCount').text('Active : ' + @Html.Raw(Json.Encode(activeCount)));
    $('#divInactiveCount').text('Inactive : ' + @Html.Raw(Json.Encode(inactiveCount)));
</script>

